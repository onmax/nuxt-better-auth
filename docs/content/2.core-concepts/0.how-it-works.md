---
title: How It Works
description: Understand the architecture and internal wiring of the module.
---

## Architecture

::steps
### 1. Initialization
At build time, the module scans your `server/auth.config.ts`, generates the necessary database schema, and configures the NuxtHub connection.

### 2. Server Runtime
The module injects a catch-all API handler at `/api/auth/**`. This handler processes all authentication requests (login, logout, session fetching) using the configuration provided in `server/auth.config.ts`.

### 3. Client Runtime
On the client side, `useUserSession` initializes the Better Auth client. It establishes a reactive connection to the session state, ensuring that your UI updates immediately when a user logs in or out.
::

## Key Responsibilities

| Component | Responsibility |
| :--- | :--- |
| **Server Handler** | Processes `/api/auth/*` requests. |
| **Middleware** | Protects routes based on `auth` meta or `routeRules`. |
| **Composables** | `useUserSession` provides reactive state and auth methods. |
| **Schema Generator** | Automates Drizzle table creation for NuxtHub. |

## Base URL Resolution

The module determines the authentication base URL in the following order:

1. `runtimeConfig.public.siteUrl` (Recommended for production)
2. The current request origin (Development fallback)

::callout{icon="i-lucide-globe"}
**Production Tip**: Always set `NUXT_PUBLIC_SITE_URL` in production to ensure correct redirect URIs for OAuth providers.
::