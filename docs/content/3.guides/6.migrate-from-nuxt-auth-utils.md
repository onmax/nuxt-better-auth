---
title: Migrating from nuxt-auth-utils
description: Step-by-step guide to migrate from nuxt-auth-utils to Nuxt Better Auth.
---

This guide covers migrating from [`nuxt-auth-utils`](https://github.com/atinux/nuxt-auth-utils) to Nuxt Better Auth.

::warning
**Significant migration**: nuxt-auth-utils stores sessions in encrypted cookies. Better Auth uses database-backed sessions with typed users. Plan accordingly.
::

::callout{icon="i-lucide-info" to="https://www.better-auth.com/docs"}
This module is a **Nuxt wrapper** around [Better Auth](https://www.better-auth.com). Most auth logic (OAuth providers, plugins, email/password, etc.) is configured via Better Auth. Refer to their docs for provider-specific setup.
::

## Why Migrate?

| nuxt-auth-utils | Nuxt Better Auth |
| :--- | :--- |
| Session-only (cookie storage) | Database-backed user records |
| Manual OAuth handlers per provider | Declarative OAuth config |
| Generic session object | Full TypeScript inference from plugins |
| Limited plugin ecosystem | Rich plugins (admin, 2FA, passkeys, orgs) |
| Manual session management | Built-in signIn/signUp/signOut |

## Key Differences

### Session Architecture

**nuxt-auth-utils**: Arbitrary data in encrypted cookies via `NUXT_SESSION_PASSWORD`. No database required.

**Better Auth**: Database stores users + sessions. Cookies contain session tokens referencing DB records.

### Composable API

```ts
// nuxt-auth-utils
const { user, loggedIn, ready, fetch, clear } = useUserSession()

// nuxt-better-auth
const { user, session, loggedIn, ready, signIn, signUp, signOut, fetchSession, client } = useUserSession()
```

### OAuth Handling

```ts
// nuxt-auth-utils - Event handler per provider
// server/routes/auth/github.get.ts
export default defineOAuthGitHubEventHandler({
  async onSuccess(event, { user }) {
    await setUserSession(event, { user: { id: user.id, name: user.name } })
    return sendRedirect(event, '/')
  }
})
```

```ts
// nuxt-better-auth - Declarative config
// server/auth.config.ts
export default defineServerAuth(() => ({
  socialProviders: {
    github: {
      clientId: process.env.NUXT_OAUTH_GITHUB_CLIENT_ID!,
      clientSecret: process.env.NUXT_OAUTH_GITHUB_CLIENT_SECRET!
    }
  }
}))
```

## Migration Steps

::steps

### Remove nuxt-auth-utils

```bash
npx nuxi module rm nuxt-auth-utils
```

You can also delete `NUXT_SESSION_PASSWORD` from your `.env` file.

### Install Nuxt Better Auth

Follow the [Installation Guide](/getting-started/installation) to set up the module, environment variables, database, and configuration files.

::callout{icon="i-lucide-info" to="/guides/database-less-mode"}
For OAuth-only apps, **Database-less Mode** stores sessions in JWE cookies similar to nuxt-auth-utils.
::

### Migrate OAuth Providers

**Before:**

```ts [server/routes/auth/github.get.ts]
export default defineOAuthGitHubEventHandler({
  config: { scope: ['user:email'] },
  async onSuccess(event, { user }) {
    await setUserSession(event, {
      user: { id: user.id, name: user.name, email: user.email }
    })
    return sendRedirect(event, '/dashboard')
  }
})
```

**After:**

```ts [server/auth.config.ts]
export default defineServerAuth(() => ({
  socialProviders: {
    github: {
      clientId: process.env.NUXT_OAUTH_GITHUB_CLIENT_ID!,
      clientSecret: process.env.NUXT_OAUTH_GITHUB_CLIENT_SECRET!,
      scope: ['user:email']
    }
  }
}))
```

Delete your OAuth route files (`server/routes/auth/*.ts`) - Better Auth handles routes automatically at `/api/auth/**`.

::callout{icon="i-lucide-external-link" to="https://www.better-auth.com/docs/concepts/oauth"}
See **Better Auth OAuth docs** for all supported providers and configuration options.
::

### Update Session Usage

**Before:**

```vue
<script setup>
const { user, loggedIn, fetch, clear } = useUserSession()

async function logout() {
  await clear()
  navigateTo('/login')
}
</script>
```

**After:**

```vue
<script setup>
const { user, loggedIn, signOut } = useUserSession()

async function logout() {
  await signOut()
  navigateTo('/login')
}
</script>
```

### Migrate Route Protection

**Before** (custom middleware):

```ts [middleware/auth.ts]
export default defineNuxtRouteMiddleware((to) => {
  const { loggedIn } = useUserSession()
  if (!loggedIn.value && to.path.startsWith('/app')) {
    return navigateTo('/login')
  }
})
```

**After** (route rules):

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  routeRules: {
    '/app/**': { auth: 'user' },
    '/login': { auth: 'guest' },
    '/admin/**': { auth: { user: { role: 'admin' } } }
  },
  auth: {
    redirects: { login: '/login', guest: '/' }
  }
})
```

Delete your custom auth middleware.

### Migrate API Protection

**Before:**

```ts [server/api/protected.get.ts]
export default defineEventHandler(async (event) => {
  const session = await requireUserSession(event)
  return { userId: session.user.id }
})
```

**After:**

```ts [server/api/protected.get.ts]
export default defineEventHandler(async (event) => {
  const { user } = await requireUserSession(event)
  return { userId: user.id }
})
```

With field matching:

```ts
const { user } = await requireUserSession(event, {
  user: { role: 'admin' }
})
```

::

## API Reference

| nuxt-auth-utils | nuxt-better-auth | Notes |
| :--- | :--- | :--- |
| `useUserSession().user` | `useUserSession().user` | Now typed from config |
| `useUserSession().fetch()` | `useUserSession().fetchSession()` | Renamed |
| `useUserSession().clear()` | `useUserSession().signOut()` | Renamed + server call |
| `setUserSession(event, data)` | N/A | Handled by Better Auth |
| `getUserSession(event)` | `getUserSession(event)` | Returns `{ user, session }` |
| `requireUserSession(event)` | `requireUserSession(event, opts?)` | Supports field matching |
| `clearUserSession(event)` | N/A | Use client `signOut()` |
| `defineOAuth*EventHandler` | `socialProviders` config | Declarative |

## Special Cases

### Password Hashing Migration

::important
nuxt-auth-utils uses **scrypt** for password hashing. Better Auth uses **Argon2id** by default. Existing password hashes will not work without migration.
::

#### Option 1: Require Password Resets (Recommended)

The simplest approach: require all users to reset their passwords during migration.

1. Set all user passwords to `null` in your database
2. Direct users to password reset flow on first login
3. New passwords will use Argon2id

#### Option 2: Support Both Hash Formats

Implement a custom password verifier that tries both formats:

```ts [server/auth.config.ts]
import { scrypt, timingSafeEqual } from 'node:crypto'

async function verifyLegacyHash(password: string, hash: string): Promise<boolean> {
  // Implement scrypt verification for legacy hashes
  // Return true if password matches legacy hash
}

export default defineServerAuth(() => ({
  // Custom verification logic
}))
```

#### Option 3: Gradual Migration

Verify with scrypt first, then re-hash with Argon2id on successful login:

```ts
// On successful legacy verification:
const newHash = await hashPassword(password) // Argon2id
await updateUserPassword(userId, newHash)
```

### WebAuthn Migration

If you used WebAuthn with nuxt-auth-utils:

1. Export your WebAuthn credentials from the old format
2. Install the Better Auth WebAuthn plugin
3. Import credentials to the new schema

::callout{to="https://www.better-auth.com/docs/plugins/webauthn" external}
See Better Auth WebAuthn documentation for schema requirements.
::

### Data Migration

Better Auth creates `user`, `session`, and `account` tables. After setup, run schema generation:

::callout{icon="i-lucide-arrow-right" to="/getting-started/schema-generation"}
See **Schema Generation** to set up database tables.
::

## Troubleshooting

### Sessions not persisting
Ensure `NUXT_BETTER_AUTH_SECRET` is set and database is configured.

### OAuth redirect errors
Auto-detected on Vercel/Cloudflare/Netlify. For other platforms, set `NUXT_PUBLIC_SITE_URL`.

### Type errors on user fields
Run type augmentation - see [Type Augmentation](/getting-started/type-augmentation).
