---
title: Protecting API Routes
description: Server-side API protection with requireUserSession and route rules.
---

## Basic Protection

```ts
const session = await requireUserSession(event)
```

## Field Matching

Require specific user field values:

```ts
const session = await requireUserSession(event, {
  user: { role: 'admin' }
})
```

Use arrays for OR logic:

```ts
const session = await requireUserSession(event, {
  user: { role: ['admin', 'moderator'] }
})
```

## Custom Rule Callback

For complex logic, use a typed callback:

```ts
const session = await requireUserSession(event, {
  rule: ({ user, session }) => {
    return user.role === 'admin' || user.teamRole === 'owner'
  }
})
```

The `user` and `session` parameters are fully typed based on your `auth.config.ts` plugins.

## Combining Options

Field matching and custom rules can be combined:

```ts
const session = await requireUserSession(event, {
  user: { emailVerified: true },
  rule: ({ user }) => user.subscriptionActive
})
```

## Route Rules for APIs

Protect API routes declaratively in your Nuxt config:

```ts
// nuxt.config.ts
export default defineNuxtConfig({
  routeRules: {
    '/api/admin/**': { auth: { user: { role: 'admin' } } },
    '/api/public/**': { auth: 'guest' },
  }
})
```

See also:
- [Security Caveats](/core-concepts/security-caveats)
