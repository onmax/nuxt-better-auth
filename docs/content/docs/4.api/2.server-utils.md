---
title: Server Utilities
description: API reference for server-side helpers available in Nitro event handlers.
---

## serverAuth

Returns the initialized Better Auth instance. This function is memoized and safe to call multiple times per request.

```ts
const auth = await serverAuth()
// Access Better Auth API directly
const session = await auth.api.getSession({ headers: event.headers })
```

::callout{icon="i-lucide-info"}
This is useful if you need to access advanced Better Auth features that aren't exposed by the helper wrappers.
::

## getUserSession

Retrieves the current session from the request context without throwing an error if unauthenticated.

```ts
export default defineEventHandler(async (event) => {
  const session = await getUserSession(event)
  
  if (session) {
    // ...
  }
})
```

**Returns:**
- `{ user: AuthUser, session: AuthSession }` if authenticated.
- `null` if unauthenticated.

## requireUserSession

Ensures the user is authenticated and optionally matches specific criteria. Throws a `401 Unauthorized` or `403 Forbidden` error if checks fail.

```ts
const { user, session } = await requireUserSession(event, options?)
```

### Options

| Option | Type | Description |
| :--- | :--- | :--- |
| `user` | `UserMatch` | Object matching user properties (see Route Protection). |
| `rule` | `(ctx) => boolean | Promise<boolean>` | Custom validation callback. |

### Examples

**Role Check:**

```ts
await requireUserSession(event, {
  user: { role: 'admin' }
})
```

**Custom Rule:**

```ts
await requireUserSession(event, {
  rule: ({ user }) => {
    return user.points > 100
  }
})
```